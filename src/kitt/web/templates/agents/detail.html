{% extends "base.html" %}
{% block title %}KITT - Agent: {{ agent.name }}{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold">{{ agent.name }}</h1>
            <p class="text-kitt-dim text-sm mt-1">{{ agent.hostname }}:{{ agent.port }}</p>
        </div>
        <div class="flex items-center space-x-3">
            <span class="inline-flex items-center space-x-1.5 px-3 py-1 rounded-full text-sm
                  {% if agent.status == 'online' %}bg-green-900/50 text-green-300
                  {% elif agent.status == 'busy' %}bg-yellow-900/50 text-yellow-300
                  {% else %}bg-gray-800 text-gray-400{% endif %}">
                <span class="w-2 h-2 rounded-full
                      {% if agent.status == 'online' %}bg-green-400
                      {% elif agent.status == 'busy' %}bg-yellow-400
                      {% else %}bg-gray-500{% endif %}"></span>
                <span>{{ agent.status }}</span>
            </span>
            <form action="/agents/{{ agent.id }}/delete" method="POST"
                  onsubmit="return confirm('Remove this agent?')">
                <button type="submit" class="text-red-400 hover:text-red-300 text-sm">Remove</button>
            </form>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- GPU info -->
        <div class="bg-kitt-surface rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-4">GPU</h2>
            <dl class="space-y-3 text-sm">
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Model</dt>
                    <dd>{{ hw.get('gpu_model') or agent.gpu_info or '-' }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">VRAM</dt>
                    <dd>{% if hw.get('gpu_vram_gb') %}{{ hw.gpu_vram_gb }}GB{% elif agent.gpu_info %}{{ agent.gpu_info.split()[-1] if 'GB' in agent.gpu_info else '-' }}{% else %}-{% endif %}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Count</dt>
                    <dd>{{ hw.get('gpu_count') or agent.gpu_count or '-' }}</dd>
                </div>
                {% if hw.get('gpu_compute_capability') %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Compute Capability</dt>
                    <dd>{{ hw.gpu_compute_capability }}</dd>
                </div>
                {% endif %}
                {% if hw.get('cuda_version') %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">CUDA</dt>
                    <dd>{{ hw.cuda_version }}</dd>
                </div>
                {% endif %}
                {% if hw.get('driver_version') %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Driver</dt>
                    <dd>{{ hw.driver_version }}</dd>
                </div>
                {% endif %}
            </dl>
        </div>

        <!-- CPU & Memory -->
        <div class="bg-kitt-surface rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-4">CPU & Memory</h2>
            <dl class="space-y-3 text-sm">
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">CPU</dt>
                    <dd>{{ hw.get('cpu_model') or agent.cpu_info or '-' }}</dd>
                </div>
                {% if hw.get('cpu_cores') %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Cores</dt>
                    <dd>{{ hw.cpu_cores }}{% if hw.get('cpu_threads') and hw.cpu_threads != hw.cpu_cores %} ({{ hw.cpu_threads }} threads){% endif %}</dd>
                </div>
                {% endif %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">RAM</dt>
                    <dd>{% if agent.ram_gb %}{{ agent.ram_gb }}GB{% if hw.get('ram_type') %} {{ hw.ram_type }}{% endif %}{% else %}-{% endif %}</dd>
                </div>
            </dl>
        </div>

        <!-- Storage & OS -->
        <div class="bg-kitt-surface rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-4">Storage & OS</h2>
            <dl class="space-y-3 text-sm">
                {% if hw.get('storage_model') %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Storage</dt>
                    <dd>{% if hw.get('storage_brand') and hw.storage_brand != 'Unknown' %}{{ hw.storage_brand }} {% endif %}{{ hw.storage_model }}{% if hw.get('storage_type') %} ({{ hw.storage_type | upper }}){% endif %}</dd>
                </div>
                {% endif %}
                {% if hw.get('os') %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">OS</dt>
                    <dd>{{ hw.os }}</dd>
                </div>
                {% endif %}
                {% if hw.get('kernel') %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Kernel</dt>
                    <dd class="text-xs font-mono truncate max-w-xs" title="{{ hw.kernel }}">{{ hw.kernel }}</dd>
                </div>
                {% endif %}
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Environment</dt>
                    <dd>{{ hw.get('environment_type') or agent.environment_type or '-' }}</dd>
                </div>
            </dl>
        </div>

        <!-- Connection info -->
        <div class="bg-kitt-surface rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-4">Connection</h2>
            <dl class="space-y-3 text-sm">
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Registered</dt>
                    <dd>{{ agent.registered_at[:19] if agent.registered_at else '-' }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">Last Heartbeat</dt>
                    <dd>{{ agent.last_heartbeat[:19] if agent.last_heartbeat else '-' }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-kitt-dim">KITT Version</dt>
                    <dd>{{ agent.kitt_version or '-' }}</dd>
                </div>
            </dl>
        </div>
    </div>

    <!-- Fingerprint -->
    {% set fp = hw.get('fingerprint') or agent.fingerprint %}
    {% if fp %}
    <div class="bg-kitt-surface rounded-lg p-5">
        <h2 class="text-lg font-semibold mb-2">Hardware Fingerprint</h2>
        <p class="text-xs font-mono break-all text-kitt-dim">{{ fp }}</p>
    </div>
    {% endif %}

    {% if agent.notes %}
    <div class="bg-kitt-surface rounded-lg p-5">
        <h2 class="text-lg font-semibold mb-2">Notes</h2>
        <p class="text-sm text-kitt-dim">{{ agent.notes }}</p>
    </div>
    {% endif %}
</div>
{% endblock %}
