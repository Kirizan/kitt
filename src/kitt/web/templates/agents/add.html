{% extends "base.html" %}
{% block title %}KITT - Add Agent{% endblock %}

{% block content %}
<div class="space-y-6 max-w-3xl">
    <div>
        <h1 class="text-2xl font-bold">Add Agent</h1>
        <p class="text-kitt-dim text-sm mt-1">Set up a KITT agent on a GPU server</p>
    </div>

    <div class="bg-kitt-surface rounded-lg p-6 space-y-6">
        <div>
            <h2 class="text-lg font-semibold mb-3">1. Install</h2>
            <p class="text-kitt-dim text-sm mb-3">Run this on the GPU server. It creates a virtual environment, downloads the agent package, provisions a unique auth token, and configures the agent.</p>
            <div class="bg-kitt-bg rounded-md p-4 font-mono text-sm break-all">
                <code>curl -fL {{ server_url }}/api/v1/agent/install.sh | bash</code>
            </div>
            <p class="text-kitt-dim text-xs mt-2">Each install generates a unique per-agent token. The server stores only a SHA-256 hash — the raw token is never persisted on the server.</p>
        </div>

        <div>
            <h2 class="text-lg font-semibold mb-3">2. Start</h2>
            <p class="text-kitt-dim text-sm mb-3">Start the agent in the foreground:</p>
            <div class="bg-kitt-bg rounded-md p-4 font-mono text-sm">
                <code>~/.kitt/agent-venv/bin/kitt-agent start</code>
            </div>
            <p class="text-kitt-dim text-xs mt-3">Or install as a systemd service for persistent deployment:</p>
            <div class="bg-kitt-bg rounded-md p-4 font-mono text-sm mt-2">
                <code>~/.kitt/agent-venv/bin/kitt-agent service install</code>
            </div>
        </div>

        <div>
            <h2 class="text-lg font-semibold mb-3">3. Verify</h2>
            <p class="text-kitt-dim text-sm">Once the agent starts, it will appear on the <a href="/agents" class="text-kitt-accent hover:underline">Agents page</a> within a few seconds.</p>
        </div>
    </div>

    <div class="bg-kitt-surface rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-3">Security</h2>
        <p class="text-kitt-dim text-sm mb-3">Each agent receives a unique authentication token during installation:</p>
        <ul class="text-kitt-dim text-sm space-y-1 list-disc list-inside">
            <li>Tokens are 256-bit random values generated by the server</li>
            <li>The server stores only the SHA-256 hash — never the raw token</li>
            <li>Compromising one agent does not affect other agents</li>
            <li>Tokens can be rotated from the Agents page or via the API</li>
        </ul>
    </div>

    <div class="bg-kitt-surface rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-3">Configuration</h2>
        <p class="text-kitt-dim text-sm mb-3">The install script automatically configures the agent. The config is stored at <code class="text-xs">~/.kitt/agent.yaml</code>:</p>
        <div class="bg-kitt-bg rounded-md p-4 font-mono text-sm space-y-1">
            <code>name: &lt;hostname&gt;</code><br>
            <code>server_url: {{ server_url }}</code><br>
            <code>token: (provisioned — unique per agent)</code><br>
            <code>port: 8090</code>
        </div>
        <p class="text-kitt-dim text-sm mt-3">To reconfigure or rotate an agent's token, re-run the install script or use the API:</p>
        <div class="bg-kitt-bg rounded-md p-4 font-mono text-sm mt-2 break-all">
            <code>curl -fL {{ server_url }}/api/v1/agent/install.sh | bash</code>
        </div>
    </div>

    <div class="bg-kitt-surface rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-3">Manual install</h2>
        <p class="text-kitt-dim text-sm mb-3">If you prefer to install step by step:</p>
        <div class="bg-kitt-bg rounded-md p-4 font-mono text-sm space-y-1">
            <code># Create virtual environment</code><br>
            <code>python3 -m venv ~/.kitt/agent-venv</code><br>
            <br>
            <code># Download and install the agent package</code><br>
            <code>curl -fL {{ server_url }}/api/v1/agent/package -o /tmp/kitt-agent.tar.gz</code><br>
            <code>~/.kitt/agent-venv/bin/pip install /tmp/kitt-agent.tar.gz</code><br>
            <br>
            <code># Configure the agent (use a token from the install script or API)</code><br>
            <code>~/.kitt/agent-venv/bin/kitt-agent init --server {{ server_url }} --token &lt;TOKEN&gt;</code><br>
            <br>
            <code># Start the agent</code><br>
            <code>~/.kitt/agent-venv/bin/kitt-agent start</code>
        </div>
    </div>
</div>
{% endblock %}
