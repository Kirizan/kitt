{% extends "base.html" %}
{% block title %}KITT - Quick Tests{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold">Quick Tests</h1>
            <p class="text-kitt-dim text-sm mt-1">Single benchmark test history</p>
        </div>
        <a href="/quicktest/new" class="bg-kitt-accent hover:bg-kitt-accent/80 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
            New Test
        </a>
    </div>

    <!-- Status filter chips -->
    <div class="flex gap-2">
        {% set statuses = ['', 'queued', 'dispatched', 'running', 'completed', 'failed'] %}
        {% for s in statuses %}
        <a href="/quicktest{% if s %}?status={{ s }}{% endif %}"
           class="px-3 py-1 rounded-full text-xs font-medium transition-colors
                  {% if current_status == s %}bg-kitt-accent text-white
                  {% else %}bg-kitt-surface text-kitt-dim hover:text-white{% endif %}">
            {{ s if s else 'All' }}
        </a>
        {% endfor %}
    </div>

    {% if tests %}
    <div class="bg-kitt-surface rounded-lg overflow-hidden">
        <table class="w-full text-sm">
            <thead>
                <tr class="text-kitt-dim text-left bg-kitt-primary/50">
                    <th class="px-4 py-3 font-medium">Model</th>
                    <th class="px-4 py-3 font-medium">Engine</th>
                    <th class="px-4 py-3 font-medium">Agent</th>
                    <th class="px-4 py-3 font-medium">Status</th>
                    <th class="px-4 py-3 font-medium">Created</th>
                    <th class="px-4 py-3 font-medium">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-kitt-primary/20">
                {% for t in tests %}
                <tr class="hover:bg-kitt-bg/30">
                    <td class="px-4 py-3">
                        <a href="/quicktest/{{ t.id }}" class="font-medium hover:text-kitt-accent">
                            {{ t.model_path.split('/')[-1] if '/' in t.model_path else t.model_path }}
                        </a>
                        <p class="text-xs text-kitt-dim mt-0.5 truncate max-w-xs">{{ t.model_path }}</p>
                    </td>
                    <td class="px-4 py-3 text-kitt-dim">{{ t.engine_name }}</td>
                    <td class="px-4 py-3 text-kitt-dim">{{ t.agent_name or 'unknown' }}</td>
                    <td class="px-4 py-3">
                        <span class="text-xs px-2 py-0.5 rounded
                              {% if t.status == 'running' %}bg-blue-900/50 text-blue-300
                              {% elif t.status == 'completed' %}bg-green-900/50 text-green-300
                              {% elif t.status == 'failed' %}bg-red-900/50 text-red-300
                              {% elif t.status == 'queued' or t.status == 'dispatched' %}bg-yellow-900/50 text-yellow-300
                              {% else %}bg-gray-800 text-gray-400{% endif %}">
                            {{ t.status }}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-kitt-dim text-xs">{{ t.created_at[:19] if t.created_at else '-' }}</td>
                    <td class="px-4 py-3">
                        <a href="/quicktest/{{ t.id }}" class="text-kitt-accent hover:underline text-xs">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if pages > 1 %}
    <div class="flex justify-center gap-2">
        {% for p in range(1, pages + 1) %}
        <a href="/quicktest?page={{ p }}{% if current_status %}&status={{ current_status }}{% endif %}"
           class="px-3 py-1 rounded text-sm
                  {% if page == p %}bg-kitt-accent text-white{% else %}bg-kitt-surface text-kitt-dim hover:text-white{% endif %}">
            {{ p }}
        </a>
        {% endfor %}
    </div>
    {% endif %}
    {% else %}
    <div class="bg-kitt-surface rounded-lg p-12 text-center">
        <p class="text-kitt-dim mb-4">No tests yet.</p>
        <a href="/quicktest/new" class="text-kitt-accent hover:underline">Run your first quick test</a>
    </div>
    {% endif %}
</div>
{% endblock %}
