{% extends "base.html" %}
{% block title %}KITT - Models{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold">Models</h1>
            <p class="text-kitt-dim text-sm mt-1">Search and manage models via Devon</p>
        </div>
        <a href="/models/library" class="text-sm text-kitt-accent hover:underline">Local Library</a>
    </div>

    {% if not devon_configured %}
    <div class="bg-kitt-surface border border-kitt-primary/50 rounded-lg p-4 text-sm text-kitt-dim">
        Devon is not configured. Set it up in <a href="/settings" class="text-kitt-accent hover:underline">Settings</a>
        or on the <a href="/devon" class="text-kitt-accent hover:underline">Devon</a> page.
    </div>
    {% endif %}

    {% if error %}
    <div class="bg-red-900/30 border border-red-700 rounded-lg p-4 text-sm text-red-200">
        Devon connection error: {{ error }}
    </div>
    {% endif %}

    <!-- Search bar -->
    <div class="bg-kitt-surface rounded-lg p-4">
        <form method="GET" action="/models" class="flex gap-3">
            <input type="text" name="q" value="{{ query }}" placeholder="Search models (e.g., llama, qwen, mistral)..."
                   class="flex-1 bg-kitt-bg border border-kitt-primary/50 rounded-md px-4 py-2 text-sm focus:outline-none focus:border-kitt-accent"
                   hx-get="/api/v1/models/search" hx-trigger="keyup changed delay:300ms" hx-target="#search-results">
            <button type="submit" class="bg-kitt-accent hover:bg-kitt-accent/80 text-white px-6 py-2 rounded-md text-sm font-medium transition-colors">
                Search
            </button>
        </form>
    </div>

    <!-- Search results -->
    <div id="search-results">
        {% if results %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for model in results %}
            <div class="bg-kitt-surface rounded-lg p-4">
                <h3 class="font-medium text-sm truncate" title="{{ model.repo_id }}">{{ model.name or model.repo_id }}</h3>
                <p class="text-kitt-dim text-xs mt-1">{{ model.source }}</p>
                <div class="flex items-center justify-between mt-3">
                    <div class="text-xs text-kitt-dim">
                        {% if model.size_gb %}<span>{{ "%.1f"|format(model.size_gb) }}GB</span>{% endif %}
                        {% if model.downloads %}<span class="ml-2">{{ model.downloads }} downloads</span>{% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% elif query and not error %}
        <div class="bg-kitt-surface rounded-lg p-8 text-center">
            <p class="text-kitt-dim">No models found for "{{ query }}"</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
